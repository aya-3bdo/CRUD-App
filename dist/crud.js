import{docElementsGetter,RowGenerator}from"./getElementsModule.js";const{input:input,header:header,head:head,select:select,td:td,brandContainer:brandContainer,categoryContainer:categoryContainer,btnCover:btnCover,switcher:switcher,plusMinusBtn:plusMinusBtn,textData:textData,itemsNumContainer:itemsNumContainer,searchArrows:searchArrows,th:th,BrandModel:BrandModel,price:price,tax:tax,discount:discount,submit:submit,clearBtn:clearBtn,itemsNum:itemsNum,tBody:tBody,topBtn:topBtn,brandSearch:brandSearch,categorySearch:categorySearch,searchArrow1:searchArrow1,searchArrow2:searchArrow2,tableButtons:tableButtons,srchTableButtons:srchTableButtons,categoryInput:categoryInput,brandInput:brandInput,body:body,addBrandInput:addBrandInput,addCategoryInput:addCategoryInput,span:span,idNumber:idNumber,numbersData:numbersData}=docElementsGetter;let updatedElementGlobalizer,total=numbersData?.nextElementSibling,itemsStore=[],darkMode=localStorage.getItem("dark-mode");const fireTableBtns=()=>{[...tableButtons]?.forEach((e=>{e.addEventListener("click",(t=>{e.id===t.target.id&&"Delete"===t.target.innerText?deleteItem(t.target.id):updateItem(t.target.id)}))}))},fireSrchTableBtns=e=>{[...srchTableButtons]?.forEach(((t,a)=>{t.addEventListener("click",(t=>{let a=Number(t.target.parentNode.parentNode.childNodes[1].innerText),n=e?.find(((e,t)=>+e.id===a));n.id===a&&"Delete"===t.target.innerText?deleteItem(a-1):updateItem(a-1)}))}))},itemsNumCheck_fallBack=function(){if(null===itemsNum.value||void 0===itemsNum.value||""===itemsNum.value)return itemsNum.value=1};input[5].value=null,input[6].value=null;let state="dataCreation";const tableBtn=document.getElementsByClassName("tableBtn");submit.innerText="add item",retrieveData(),createData(),brandInput.style.display="block",addBrandInput.style.display="none",categoryInput.style.display="block",addCategoryInput.style.display="none";const lightModeArr=[switcher,body,header,head,total,topBtn,submit,clearBtn],lightModeArrays=[input,select,btnCover,plusMinusBtn,textData.children,numbersData.children,searchArrows,th,td,tableBtn],enableDarkMode=()=>{lightModeArr.forEach((e=>{e.classList.add("light-mode")}));for(let e of lightModeArrays)[...e].forEach((e=>{e.classList.add("light-mode")}));localStorage.setItem("dark-mode","enabled")},disableDarkMode=()=>{lightModeArr.forEach((e=>{e.classList.remove("light-mode")}));for(let e of lightModeArrays)[...e].forEach((e=>{e.classList.remove("light-mode")}));localStorage.setItem("dark-mode","disabled")};function discountPercent(e){if(e>=0)return(100-+e)/100}function taxPercent(e){if(e>=0)return(+e+100)/100}function getTotalPrice(){if(void 0===getTotalPriceForAnItem())return total.innerText="$$";{let e;e=+price.value*+taxPercent(tax.value)*+discountPercent(discount.value)*+itemsNum.value,total.appendChild(span),!1===Number.isInteger(e)?span.innerText=` : ${parseFloat(e).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}$ `:span.innerText=`: ${e} $ `}}function getTotalPriceForAnItem(){let e=price.value*discountPercent(discount.value)*taxPercent(tax.value)*1;return 0==Number.isInteger(e)?parseFloat(e).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):e}function updateItem(e){state="dataUpdating",submit.innerText="update item",input[6].style.display="none",btnCover[3].style.display="none",plusMinusBtn[3].style.display="none",itemsNumContainer.appendChild(idNumber);let t=JSON.parse(localStorage.getItem("itemsData"))[e];updatedElementGlobalizer=e,brandInput.style.display="none",addBrandInput.style.display="block",categoryInput.style.display="none",addCategoryInput.style.display="block";addBrandInput.value=t.brand,BrandModel.value=t.BrandModel,addCategoryInput.value=t.category,price.value=t.price,tax.value=t.tax,discount.value=t.discount,idNumber.innerText="item's id: "+(+e+1)}function clearInputs(){brandInput.value="none",BrandModel.value=null,categoryInput.value="none",price.value=null,tax.value=null,discount.value=null,itemsNum.value=null;return input[5].value=null,input[6].value=null,span.innerText=null,addBrandInput.value=null,addCategoryInput.value=null,input[6].style.display="block",btnCover[3].style.display="block",plusMinusBtn[3].style.display="block",idNumber.innerText=null,submit.innerText="add item",brandInput.style.display="block",addBrandInput.style.display="none",categoryInput.style.display="block",addCategoryInput.style.display="none",!0}function searchByBrand(){let e=[];JSON.parse(localStorage.getItem("itemsData")).forEach((t=>{!0===t.brand.toLocaleLowerCase().includes(brandSearch.value)&&e.push(t),new RowGenerator(e).createTableItems("srch-tableBtn"),fireSrchTableBtns(e),fixTdColor()}))}function brandArrow(){searchArrow1.addEventListener("click",(()=>{searchByBrand()}),{once:!0})}function searchByCategory(){let e=[];JSON.parse(localStorage.getItem("itemsData")).forEach((t=>{1==t.category.toLocaleLowerCase().includes(categorySearch.value)&&e.push(t),new RowGenerator(e).createTableItems("srch-tableBtn"),fireSrchTableBtns(e),fixTdColor()}))}function categoryArrow(){searchArrow2.addEventListener("click",(()=>{searchByCategory()}),{once:!0})}function addNewBrandInput(){return brandContainer.appendChild(addBrandInput),addBrandInput.setAttribute("placeholder","enter brand name"),addBrandInput.id="brand-input",brandInput.style.display="none",addBrandInput.style.display="block",""!==addBrandInput.value?addBrandInput.value:brandInput.value}function addNewCategoryInput(){return categoryInput.style.display="none",categoryContainer.appendChild(addCategoryInput),addCategoryInput.setAttribute("placeholder","enter category"),addCategoryInput.id="category-input",addCategoryInput.style.display="block",""!==addCategoryInput.value?addCategoryInput.value:categoryInput.value}function createData(){let e={brand:addNewBrandInput(),BrandModel:BrandModel.value,category:addNewCategoryInput(),price:price.value,tax:tax.value,discount:discount.value,priceOfOneItem:getTotalPriceForAnItem()};if("dataCreation"===state&&"none"!==e.brand&&void 0!==price.value&&null!==price.value&&"none"!==e.category&&null!==tax.value&&null!==discount.value){itemsNumCheck_fallBack();for(let t=0;t<itemsNum.value;t++)itemsStore.push(e)}"dataCreation"!==state&&(itemsStore[updatedElementGlobalizer]=e,location.reload()),new RowGenerator(itemsStore).createTableItems("tableBtn"),itemsStore?.length>1&&(clearBtn.style.display="block"),localStorage.setItem("itemsData",JSON.stringify(itemsStore)),clearInputs(),fixTdColor(),fireTableBtns()}function retrieveData(){let e=JSON.parse(localStorage.getItem("itemsData"));if(localStorage.itemsData?.length>0){for(let t of e)itemsStore.push(t);return itemsStore}return 1}"enabled"===darkMode&&enableDarkMode(),switcher.addEventListener("click",(()=>{"disabled"===localStorage.getItem("dark-mode")?enableDarkMode():disableDarkMode()})),brandSearch.addEventListener("click",(()=>{searchArrow1.style.display="block",brandArrow()})),brandSearch.addEventListener("click",(()=>{searchArrow2.style.display="none";tBody.innerHTML="",categorySearch.value=null})),categorySearch.addEventListener("click",(()=>{searchArrow2.style.display="block",categoryArrow()})),categorySearch.addEventListener("click",(()=>{searchArrow1.style.display="none";tBody.innerHTML="",brandSearch.value=null})),brandInput.addEventListener("change",(()=>{if("another brand"===brandInput.value)return addNewBrandInput()})),categoryInput.addEventListener("change",(()=>{if("another category"===categoryInput.value)return addNewCategoryInput()}));const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);function deleteItem(e){const t=JSON.parse(localStorage.getItem("itemsData"));confirm(`Are you sure you want to delete "${capitalizeFirstLetter(t[e].brand)}  ${capitalizeFirstLetter(t[e].BrandModel)}" item?`)&&(t.splice(e,1),localStorage.setItem("itemsData",JSON.stringify(t)),location.reload())}clearBtn.addEventListener("click",(()=>{confirm("After taking this action, all items will be deleted .. Are you sure?")&&(localStorage.clear(),location.reload())})),window.addEventListener("scroll",(()=>{window.scrollY>250?topBtn.style.visibility="visible":topBtn.style.visibility="hidden"})),topBtn.addEventListener("click",(()=>{window.scrollTo({top:0,behavior:"smooth"})}));let numbersInputs=[price,tax,discount];function fixTdColor(){"enabled"==localStorage.getItem("dark-mode")&&[...td].forEach((e=>{e.classList.add("light-mode")}))}numbersInputs.forEach((e=>{e.addEventListener("input",(function(e){this.value=this.value.replace(/[^0-9]/g,""),isNaN(parseInt(this.value))&&(this.value=null,alert(`${this.placeholder} value must be a number.`))}))}));const validateInputs=function(){if(null!==brandInput.value&&void 0!==brandInput.value&&""!==brandInput.value&&null!==BrandModel.value&&void 0!==BrandModel.value&&""!==BrandModel.value&&null!==categoryInput.value&&void 0!==categoryInput.value&&""!==categoryInput.value&&null!==price.value&&void 0!==price.value&&""!==price.value&&null!==tax.value&&void 0!==tax.value&&""!==tax.value&&null!==discount.value&&void 0!==discount.value&&""!==discount.value&&null!==itemsNum.value&&void 0!==itemsNum.value)return!0};submit.addEventListener("click",(()=>{validateInputs()?createData():alert("Plaese check if you've filled all the fields with their right value")})),itemsNum.addEventListener("input",(()=>{itemsNum.value=itemsNum.value.replace(/[^0-9]/g,""),isNaN(parseInt(itemsNum.value))||null==itemsNum.value||null==itemsNum.value?alert(" Items number value must be a number."):itemsNum.value<1||itemsNum.value>100?(itemsNum.value=null,alert("Items number should be greater than 0 and shouldn't be exceeding 100"),itemsNum.value=itemsNum.value.replace(/[^0-9]/g,"")):getTotalPrice()}));